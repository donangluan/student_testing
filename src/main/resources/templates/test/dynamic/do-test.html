<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Làm bài kiểm tra động</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <p>Câu số: <span th:text="${answeredCount + 1}"></span> / <span th:text="${totalQuestions}"></span></p>

    <h2 class="mb-4 text-center">Làm bài kiểm tra động</h2>
    <div class="alert alert-warning text-center">
        ⏳ Thời gian còn lại: <span id="countdown" class="fw-bold text-danger">--:--</span>
    </div>


    <form th:action="@{/student/dynamic/submit-test}" method="post">
        <input type="hidden" name="testId" th:value="${testId}" />
        <input type="hidden" name="studentUsername" th:value="${studentUsername}" />
        <input type="hidden" name="questionId" th:value="${question.questionId}" />
        <input type="hidden" name="testType" th:value="${testType}" />
        <input type="hidden" name="currentDifficulty" th:value="${currentDifficulty}" />
        <input type="hidden" name="topicId" th:value="${topicId}" />


        <div class="mb-4">
            <p class="fw-bold" th:text="${question.content}">Nội dung câu hỏi</p>

            <div th:each="opt : ${options}">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="selectedOption" th:value="${opt}" th:id="${opt}" required />
                    <label class="form-check-label" th:for="${opt}">
                        <span th:switch="${opt}">
                            <span th:case="'A'" th:text="'A. ' + ${question.optionA}">A</span>
                            <span th:case="'B'" th:text="'B. ' + ${question.optionB}">B</span>
                            <span th:case="'C'" th:text="'C. ' + ${question.optionC}">C</span>
                            <span th:case="'D'" th:text="'D. ' + ${question.optionD}">D</span>
                        </span>
                    </label>
                </div>
            </div>
        </div>

        <div class="text-center">
            <button type="submit" class="btn btn-primary px-4">Trả lời</button>
        </div>
    </form>
</div>

<script>
    const duration = /*[[${duration}]]*/ 30;
    let remaining = duration * 60;

    const countdownEl = document.getElementById("countdown");

    const timer = setInterval(() => {
        if (remaining <= 0) {
            clearInterval(timer);
            countdownEl.innerText = "00:00";
            document.getElementById("submitForm").submit(); // ✅ auto-submit
        } else {
            const minutes = Math.floor(remaining / 60);
            const seconds = remaining % 60;
            countdownEl.innerText = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            remaining--;
        }
    }, 1000);
</script>
</body>
</html>
