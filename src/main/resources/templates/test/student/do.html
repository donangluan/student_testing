<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Làm bài kiểm tra</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
<h2 class="mb-4">Làm bài kiểm tra</h2>


<div class="alert alert-warning text-center">
    Thời gian còn lại: <span id="countdown" class="fw-bold text-danger">--:--</span>
</div>

<form method="post" th:action="@{/student/submit}" id="submitForm">
    <input type="hidden" name="testId" th:value="${testId}" />

    <div th:each="q : ${questions}" class="mb-4">
        <h5 th:text="${q.content}">Câu hỏi</h5>

        <div class="form-check">
            <input class="form-check-input" type="radio" th:name="${'q_' + q.questionId}" value="A" required />
            <label class="form-check-label" th:text="${q.optionA}">A</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" th:name="${'q_' + q.questionId}" value="B" />
            <label class="form-check-label" th:text="${q.optionB}">B</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" th:name="${'q_' + q.questionId}" value="C" />
            <label class="form-check-label" th:text="${q.optionC}">C</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" th:name="${'q_' + q.questionId}" value="D" />
            <label class="form-check-label" th:text="${q.optionD}">D</label>
        </div>
    </div>

    <button type="submit" class="btn btn-success">Nộp bài</button>
</form>


<script>
    const duration = /*[[${duration}]]*/ 30;
    let remaining = duration * 60;

    const countdownEl = document.getElementById("countdown");

    const timer = setInterval(() => {
        if (remaining <= 0) {
            clearInterval(timer);
            countdownEl.innerText = "00:00";
            document.getElementById("submitForm").submit();
        } else {
            const minutes = Math.floor(remaining / 60);
            const seconds = remaining % 60;
            countdownEl.innerText = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            remaining--;
        }
    }, 1000);
</script>
</body>
</html>
