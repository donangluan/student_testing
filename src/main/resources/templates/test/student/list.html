<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bài kiểm tra của tôi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
<h2 class="mb-4">Bài kiểm tra được giao</h2>
<p class="text-muted">Xin chào, <strong th:text="${studentUsername}">username</strong></p>

<div class="text-end mt-4">
    <form th:action="@{/logout}" method="post" class="d-inline">
        <button type="submit" class="btn btn-sm btn-danger">Đăng xuất</button>
    </form>
</div>

<table class="table table-bordered table-hover">
    <thead class="table-light">
    <tr>
        <th>ID</th>
        <th>Tên bài kiểm tra</th>
        <th>Loại</th>
        <th>Thao tác</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="test : ${tests}">
        <td th:text="${test.testId}">1</td>
        <td th:text="${test.testName}">Bài kiểm tra mẫu</td>
        <td th:text="${test.testType}">Unique</td>
        <td>

            <div th:if="${!testResultMap[test.testId]}">
                <!-- Nút làm bài kiểu thường -->
                <a th:href="@{'/student/do/' + ${test.testId}}"
                   class="btn btn-primary btn-sm me-2">
                    Làm bài
                </a>

                <!-- Nút làm bài động nếu có topicId -->
                <a th:if="${test.topicId != null}"
                   th:href="@{'/student/dynamic/do-test?testId=' + ${test.testId} +
                     '&studentUsername=' + ${studentUsername} +
                     '&testType=' + ${test.testType} +
                     '&topicId=' + ${test.topicId}}"
                   class="btn btn-warning btn-sm me-2">
                    Làm bài động
                </a>

                <!-- Nút làm bài động nếu là Mixed và không có topicId -->
                <a th:if="${test.topicId == null and #strings.equals(test.testType, 'Mixed')}"
                   th:href="@{'/student/dynamic/do-test?testId=' + ${test.testId} +
                     '&studentUsername=' + ${studentUsername} +
                     '&testType=Mixed'}"
                   class="btn btn-warning btn-sm">
                    Làm bài động
                </a>
            </div>

            <div th:if="${testResultMap[test.testId]}">
                <span class="text-success fw-bold me-2">Đã hoàn thành</span>
                <a th:href="@{'/results/detail/' + ${test.resultId}}" class="btn btn-sm btn-info">
                     Xem chi tiết
                </a>
            </div>

        </td>
    </tr>
    </tbody>
</table>

</body>
</html>
