<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ğŸ§  Trá»£ lÃ½ Táº¡o CÃ¢u há»i báº±ng AI</title>
    <style>
        body { font-family: sans-serif; margin: 2rem; }
        label { display: block; margin-top: 1rem; font-weight: bold; }
        textarea, input, select { width: 100%; padding: 0.5rem; margin-top: 0.5rem; }
        button { margin-top: 1rem; padding: 0.5rem 1rem; font-weight: bold; }
        .question { margin-top: 1rem; padding: 1rem; border: 1px solid #ccc; border-radius: 5px; background: #f9f9f9; }
        .error { color: red; font-weight: bold; }
    </style>
    <!-- CSRF token -->
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>

<h1>ğŸ§  Sinh cÃ¢u há»i báº±ng AI</h1>

<form id="generateForm">
    <label>ğŸ‘¨â€ğŸ« MÃ£ giÃ¡o viÃªn:
        <input type="number" name="teacherId" value="1" required>
    </label>

    <label>ğŸ“š Chá»§ Ä‘á»:
        <input type="text" name="topic" placeholder="VD: VÃ²ng láº·p trong Java" required>
    </label>

    <label>ğŸ¯ Äá»™ khÃ³:
        <select name="difficulty" required>
            <option value="Easy">Dá»…</option>
            <option value="Medium" selected>Trung bÃ¬nh</option>
            <option value="Hard">KhÃ³</option>
        </select>
    </label>

    <label>ğŸ”¢ Sá»‘ lÆ°á»£ng cÃ¢u há»i (1â€“50):
        <input type="number" name="quantity" value="5" min="1" max="50" required>
    </label>

    <button type="submit">ğŸš€ Gá»­i yÃªu cáº§u</button>
</form>

<div id="result"></div>

<script>
    document.getElementById("generateForm").addEventListener("submit", function(e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);
        const params = new URLSearchParams(formData).toString();

        const token = document.querySelector('meta[name="_csrf"]').getAttribute("content");
        const header = document.querySelector('meta[name="_csrf_header"]').getAttribute("content");

        fetch("/api/ai-questions/generate?" + params, {
            method: "POST",
            headers: {
                [header]: token
            }
        })
            .then(res => {
                if (!res.ok) throw new Error("Lá»—i tá»« server");
                return res.json();
            })
            .then(data => {
                const container = document.getElementById("result");
                if (!Array.isArray(data) || data.length === 0) {
                    container.innerHTML = "<p class='error'>âŒ KhÃ´ng cÃ³ cÃ¢u há»i nÃ o Ä‘Æ°á»£c táº¡o.</p>";
                    return;
                }

                container.innerHTML = "<h2>ğŸ“¦ Káº¿t quáº£:</h2>";
                data.forEach((q, i) => {
                    container.innerHTML += `
                <div class="question">
                    <strong>CÃ¢u ${i + 1}:</strong> ${q.questionContent}<br>
                    <em>Chá»§ Ä‘á»:</em> ${q.topic} | <em>Äá»™ khÃ³:</em> ${q.difficulty}<br>
                    <em>ÄÃ¡p Ã¡n Ä‘Ãºng:</em> ${q.correctAnswer}<br>
                    <ul>
                        <li>A. ${q.optionsMap?.A || ""}</li>
                        <li>B. ${q.optionsMap?.B || ""}</li>
                        <li>C. ${q.optionsMap?.C || ""}</li>
                        <li>D. ${q.optionsMap?.D || ""}</li>
                    </ul>
                </div>
            `;
                });
            })
            .catch(err => {
                console.error("Chi tiáº¿t lá»—i:", err);
                document.getElementById("result").innerHTML = "<p class='error'>âŒ Lá»—i khi gá»i API: " + err.message + "</p>";
            });
    });
</script>

</body>
</html>
